# Ay-yahs-Greenhouse

![Greenhouse Structure Image Distant](https://raw.githubusercontent.com/thegroundhogwhisperer/Ay-yahs-Greenhouse/master/Images/Greenhouse%20Distant%20Small%20Image.png)

![Greenhouse Structure Image Near](https://raw.githubusercontent.com/thegroundhogwhisperer/Ay-yahs-Greenhouse/master/Images/Greenhouse%20Entrance%20Small%20Image.png)

![Greenhouse Structure Interior](https://raw.githubusercontent.com/thegroundhogwhisperer/Ay-yahs-Greenhouse/master/Images/Greenhouse%20Interior%20Small%20Image.png)


# Raspberry Pi Greenhouse Automation and Remote Environmental System Monitoring Project

This is a for-fun project created for the purpose of automating and remotely monitoring climate control and irrigation in a small greenhouse. System automation is achieved using an ARM based CPU (Raspberry Pi 3) in combination with a Pimoroni Automation HAT. Remote monitoring of environmental conditions is achieved through a layered communication structure. This layered communication is performed using a combination of technologies such as text-to-speech software, Python scripts, and radio frequency transmissions. The primary greenhouse automation script and support files are contained in the Greenhouse subfolder. The remote environmental system montioring Python scripts and support files are contained in the following subfolders:  Greenhousealarm, Greenhousemanualgui, Greenhousereceivedata, Greenhousestatusttsrttysstvpots, Greenhousestatusttsrttysstvrf

# Data Flow Diagram

![Data Flow Diagram Image](https://raw.githubusercontent.com/thegroundhogwhisperer/Ay-yahs-Greenhouse/master/Images/Greenhouse%20Data%20Flow%20Diagram%20Small%20Image.png)

# Raspberry Pi Greenhouse Automation Project

Climate control and irrigation control is achieved by monitoring environmental sensor measurements. The environmental sensors measurements are then used to control a linear actuator, solenoid valve, small fan, and small heating pad. The information produced is displayed on a 16x2 LCD screen, broadcast via wall messages to the console, written to an html file, csv file, and SQLite database file.

# What it does

# Monitors

soil moisture

temperature

humidity

light

# Controls

linear actuator window opener

solenoid valve irrigation control

fan

heating pad

# Components

(1) Raspberry Pi - ADA3055

(1) Pimoroni Automation HAT - PIM213

(1) USB backpack kit and 16x2 RGB backlight LCD - ADA782

(1) Humidity sensor / Temperature sensor - DHT22 ADA385

(1) Soil moisture sensor - SEN0193

(1) Plastic water solenoid valve 1/2" - ADA997

(1) Linear actuator stroke 16" 12VDC

(1) Light dependent resistor - ADA997

(2) Two Channel Relay Controller - TS0619

(1) Oscillating Fan 12VDC - AC845

(1) Pump 12VDC 1.2GPM 35PSI - SFDP1-012-035-21

(1) USB pet heating pad carbon fiber

(1) 14 Watt USB LED grow light bar

# Installation

# Prerequisites

Adafruit_Python_DHT

Use pip to install from PyPI.

Python 2:

sudo pip install Adafruit_DHT

Python 3:

sudo pip3 install Adafruit_DHT

sudo apt-get install php-sqlite3

This script requires pigpiod.

Install pigpio from the Raspbian package manager:

sudo apt-get update

sudo apt-get install pigpio

pigpiod -v

Enable remote gpio access using the raspi-conf tool:

Execute raspi-config

Select menu item 5 Inferfacting Options.

Enable P8 Remote GPIO.

Choose Back

Choose Finish

Place all related files in the /home/pi/Greenhouse/ folder

Configure execute permissions on greenhouse.py, powerout.py, and camera.py.

sudo chmod +x greenhouse.py 

sudo chmod +x powerout.py 

sudo chmod +x camera.py 

The greenhouse.py script performs environmental monitoring and the conditional evaluation process. Configure cron to execute greenhouse.py, the primary automation script, every two minutes.

The powerout.py script writes file stored values, relays, and outputs to their default due to power outage. Configure cron to execute powerout.py, the power outage reset defaults script, at boot.

The camera.py script writes one high and one low resolution PNG image to /var/www/html. These images are referenced in the static HTML page generated by greenhouse.py

# Example crontab configuration

sudo crontab -e

\# reset default values, relays, and output states after a power outage

@reboot python /home/pi/Greenhouse/powerout.py

\# capture an image every five minutes

*/5 * * * * python /home/pi/Greenhouse/camera.py


crontab -e

\# execute the primary greenhouse automation script every two minutes

*/2 * * * * /usr/bin/python /home/pi/Greenhouse/greenhouse.py


# Manual operations desktop GUI screenshot

![Greenhouse Web Interface Screenshot One](https://raw.githubusercontent.com/thegroundhogwhisperer/Ay-yahs-Greenhouse/master/Images/Greenhouse%20Manual%20Operations%20GUI.png)

# Web interface screenshots

![Greenhouse Web Interface Screenshot One](https://raw.githubusercontent.com/thegroundhogwhisperer/Ay-yahs-Greenhouse/master/Images/Greenhouse%20Web%20Interface%20Screenshot%20One.png)

![Greenhouse Web Interface Screenshot Two](https://raw.githubusercontent.com/thegroundhogwhisperer/Ay-yahs-Greenhouse/master/Images/Greenhouse%20Web%20Interface%20Screenshot%20Two.png)

![Greenhouse Web Interface Screenshot Three](https://raw.githubusercontent.com/thegroundhogwhisperer/Ay-yahs-Greenhouse/master/Images/Greenhouse%20Web%20Interface%20Screenshot%20Three.png)

![Greenhouse Web Interface Screenshot Four](https://raw.githubusercontent.com/thegroundhogwhisperer/Ay-yahs-Greenhouse/master/Images/Greenhouse%20Web%20Interface%20Screenshot%20Four.png)

![Greenhouse Web Interface Screenshot Five](https://raw.githubusercontent.com/thegroundhogwhisperer/Ay-yahs-Greenhouse/master/Images/Greenhouse%20Web%20Interface%20Screenshot%20Five.png)

![Greenhouse Web Interface Screenshot Five](https://raw.githubusercontent.com/thegroundhogwhisperer/Ay-yahs-Greenhouse/master/Images/Greenhouse%20Web%20Interface%20Screenshot%20Six.png)


# Example camera images

![Greenhouse Camera Image Animated .GIF Low Resolution](https://raw.githubusercontent.com/thegroundhogwhisperer/Ay-yahs-Greenhouse/master/Images/Greenhouse%20Camera%20Image%20Animated%20Low%20Resolution.gif)


![Greenhouse Camera Image High Resolution](https://raw.githubusercontent.com/thegroundhogwhisperer/Ay-yahs-Greenhouse/master/Images/Greenhouse%20Camera%20Image%20High%20Resolution.jpg)


# Wiring diagrams and enclosure images

![GreenhousePi Wiring Diagram](https://raw.githubusercontent.com/thegroundhogwhisperer/Ay-yahs-Greenhouse/master/Images/Greenhouse%20Automation%20HAT%20Wiring%20Diagram%20V2%20(Smokey).png)

![Relay_Wiring Diagram](https://raw.githubusercontent.com/thegroundhogwhisperer/Ay-yahs-Greenhouse/master/Images/Greenhouse%20Automation%20HAT%20Fan%20Relay%20Controller%20Wiring%20Diagram%20Small%20Image.png)

Due to the failure rate of the DHT22 sensor a power connector from a floppy disk drive is used for quick sensor replacement.

![Sensor To Berg Connector_Wiring Example](https://raw.githubusercontent.com/thegroundhogwhisperer/Ay-yahs-Greenhouse/master/Images/DHT22%20Wiring%20Example%20Berg%204%20Pin%20Peripheral%20Connector%20To%20DHT22%20Digital%20Humidity%20Temperature%20Sensor%20Greenhouse%20Small%20Image.png)

# Automation Enclosure Images

![Greenhouse Automation System Mounted Enclosure](https://raw.githubusercontent.com/thegroundhogwhisperer/Ay-yahs-Greenhouse/master/Images/Greenhouse%20Mounted%20Enclosure%20Small%20Image.png)

![Automation Enclosure Image](https://raw.githubusercontent.com/thegroundhogwhisperer/Ay-yahs-Greenhouse/master/Images/Greenhouse-Automation-Enclosure-Complete-Small-Image.png)

Two Channel Relay Enclosure image

![Two Channel Relay Enclosure Image](https://raw.githubusercontent.com/thegroundhogwhisperer/Ay-yahs-Greenhouse/master/Images/Two-Channel-Relay-Enclosure-Complete-Small-Image.png)


# Future modifications

Add a configuration option setting the mode (variable 0 = heating pad or 1 = grow light) to allow switching between the evaluation of environmental conditions for the purpose of regulating a heating pad or regulating a grow light on Output 2. Done!

Write the system configuration values to files on the disk (e.g. The minimum soil moisture value  /home/greenhouse/minimumsoilmoisture.txt) with the intent of the file/value being remotely modified via the web interface. Done!

The system configuration values are currently constants in the main greenhouse.py application code. Not any longer; they are values stored in text files on the disk in the /var/www/html/ folder. Done!

A .php or .py script could receive form submission data from the greenhousegtkcontrol.py manual GUI interface script via urllib2 providing a method of remotely updating system configuration values stored on the GreenhousePi's disk.

A .php script now reads form submission data allowing for remote configuration of system values. Done!

This same index.php script can be used to parse POST submissions from a Python based GTK GUI application submitting from data using urllib2.

Create more detailed installation instructions. Starting with a clean Debian OS.  I need to start a wiki for this and produce some viable documentation.

Fix the graphs.... Done!

Port the manual GUI interface as an .apk if I can ever get p4a or tivy or buildozer setup correctly.

Move all the images in this repositories root folder to their own folder/directory and update the links in this document. Done!

Write a log file for manually performed procedures (e.g. Activation of the solenoid valve.) I dunno... maybe not...

Write a lovely Flask interface.  Wrote a lovely .php interface that will suffice for now.  Done!

Write remote configuration features for setting the environmental condition values (e.g. Luminosity value returned selecting when to turn off output 2).  Done!

Write a send SMS/Email script to use if the greenhouse location has internet connectivity.  The existing send SMS/Email notification script reads a RTTY log from Fldigi.  This local script could fetch and query the greenhouse.db file.

All notification scripts (e.g. greenhousealarm.py, etc.) that fetch and parse the index.csv file via wget should be recoded to fetch and query the greenhouse.db file via urllib2.  It is more efficient to query the last row of the .db file than to prase the entire index.csv file for the last line.  Using urllib2 will also eliminate the requirement of the exteral application wget.

Need to create a flow diagram of greenhouse.py

Lots of other things...






